<p-dialog 
  [(visible)]="visible" 
  [modal]="true" 
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '700px' }"
  header="Edit Project"
  (onHide)="onDialogHide()"
  styleClass="project-edit-dialog">
  
  <p-toast></p-toast>
  
  <form [formGroup]="projectForm" (ngSubmit)="onSubmit()">
    <div class="grid">
      <!-- Project Name -->
      <div class="col-12">
        <div class="field">
          <label for="name" class="font-medium text-900">Project Name</label>
          <input id="name" type="text" pInputText formControlName="name" class="w-full" />
          <small *ngIf="projectForm.get('name')?.invalid && projectForm.get('name')?.touched" class="p-error">
            Project name is required
          </small>
        </div>
      </div>
      
      <!-- Start Date -->
      <div class="col-6">
        <div class="field">
          <label for="startDate" class="font-medium text-900">Start Date</label>
          <p-calendar 
            id="startDate" 
            formControlName="startDate" 
            [showIcon]="true" 
            dateFormat="dd-mm-yy"
            [readonlyInput]="true"
            class="w-full">
          </p-calendar>
          <small *ngIf="projectForm.get('startDate')?.invalid && projectForm.get('startDate')?.touched" class="p-error">
            Start date is required
          </small>
        </div>
      </div>
      
      <!-- Deadline -->
      <div class="col-6">
        <div class="field">
          <label for="deadline" class="font-medium text-900">Deadline</label>
          <p-calendar 
            id="deadline" 
            formControlName="deadline" 
            [showIcon]="true" 
            dateFormat="dd-mm-yy"
            [readonlyInput]="true"
            class="w-full">
          </p-calendar>
        </div>
      </div>
      
      <!-- Priority -->
      <div class="col-6">
        <div class="field">
          <label for="priority" class="font-medium text-900">Priority</label>
          <p-dropdown 
            id="priority" 
            formControlName="priority" 
            [options]="priorityOptions" 
            placeholder="Select Priority"
            [style]="{'width':'100%'}"
            optionLabel="label">
          </p-dropdown>
          <small *ngIf="projectForm.get('priority')?.invalid && projectForm.get('priority')?.touched" class="p-error">
            Priority is required
          </small>
        </div>
      </div>
      
      <!-- Status -->
      <div class="col-6">
        <div class="field">
          <label for="status" class="font-medium text-900">Status</label>
          <p-dropdown 
            id="status" 
            formControlName="status" 
            [options]="statusOptions" 
            placeholder="Select Status"
            [style]="{'width':'100%'}"
            optionLabel="label">
          </p-dropdown>
          <small *ngIf="projectForm.get('status')?.invalid && projectForm.get('status')?.touched" class="p-error">
            Status is required
          </small>
        </div>
      </div>
      
      <!-- Progress -->
      <div class="col-12">
        <div class="field">
          <label for="progress" class="font-medium text-900">Progress: {{projectForm.get('progress')?.value}}%</label>
          <p-slider 
            id="progress"
            formControlName="progress"
            [min]="0"
            [max]="100"
            class="w-full">
          </p-slider>
        </div>
      </div>
      
      <!-- Project Manager -->
      <div class="col-6">
        <div class="field">
          <label for="pm" class="font-medium text-900">Project Manager</label>
          <p-dropdown 
            id="pm" 
            formControlName="pm" 
            [options]="managerOptions" 
            placeholder="Select Project Manager"
            [style]="{'width':'100%'}"
            optionLabel="label">
            <ng-template pTemplate="selectedItem" let-selectedItem>
              <div class="flex align-items-center gap-2" *ngIf="selectedItem">
                <img [src]="selectedItem.value.avatar" style="width: 24px; height: 24px; border-radius: 50%;" />
                <span>{{selectedItem.label}}</span>
              </div>
            </ng-template>
            <ng-template pTemplate="item" let-item>
              <div class="flex align-items-center gap-2">
                <img [src]="item.value.avatar" style="width: 24px; height: 24px; border-radius: 50%;" />
                <span>{{item.label}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="projectForm.get('pm')?.invalid && projectForm.get('pm')?.touched" class="p-error">
            Project Manager is required
          </small>
        </div>
      </div>
      
      <!-- Team Lead -->
      <div class="col-6">
        <div class="field">
          <label for="tl" class="font-medium text-900">Team Lead</label>
          <p-dropdown 
            id="tl" 
            formControlName="tl" 
            [options]="teamLeadOptions" 
            placeholder="Select Team Lead"
            [style]="{'width':'100%'}"
            optionLabel="label">
            <ng-template pTemplate="selectedItem" let-selectedItem>
              <div class="flex align-items-center gap-2" *ngIf="selectedItem">
                <img [src]="selectedItem.value.avatar" style="width: 24px; height: 24px; border-radius: 50%;" />
                <span>{{selectedItem.label}}</span>
              </div>
            </ng-template>
            <ng-template pTemplate="item" let-item>
              <div class="flex align-items-center gap-2">
                <img [src]="item.value.avatar" style="width: 24px; height: 24px; border-radius: 50%;" />
                <span>{{item.label}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="projectForm.get('tl')?.invalid && projectForm.get('tl')?.touched" class="p-error">
            Team Lead is required
          </small>
        </div>
      </div>
      
      <!-- Team -->
      <div class="col-12">
        <div class="field">
          <label for="team" class="font-medium text-900">Team Members</label>
          <p-multiSelect 
            id="team"
            formControlName="team"
            [options]="teamMembers"
            [style]="{'width':'100%'}"
            optionLabel="name"
            placeholder="Select Team Members" 
            display="chip">
            <ng-template pTemplate="selectedItems" let-selectedItems>
              <div class="team-avatars flex align-items-center gap-1" *ngIf="selectedItems">
                <div *ngFor="let item of selectedItems.slice(0, 5)" class="team-avatar">
                  <img [src]="item.avatar" style="width: 24px; height: 24px; border-radius: 50%;" />
                </div>
                <span *ngIf="selectedItems.length > 5">+{{selectedItems.length - 5}} more</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center gap-2">
                <img [src]="item.avatar" style="width: 24px; height: 24px; border-radius: 50%;" />
                <span>{{item.name}}</span>
              </div>
            </ng-template>
          </p-multiSelect>
          <small *ngIf="projectForm.get('team')?.invalid && projectForm.get('team')?.touched" class="p-error">
            At least one team member is required
          </small>
        </div>
      </div>
    </div>
  </form>
  
  <ng-template pTemplate="footer">
    <button pButton label="Cancel" icon="pi pi-times" (click)="onCancel()" class="p-button-text"></button>
    <button pButton label="Save" icon="pi pi-check" (click)="onSubmit()" [disabled]="projectForm.invalid"></button>
  </ng-template>
</p-dialog>